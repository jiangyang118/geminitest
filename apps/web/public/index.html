<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NotebookLM-style 知识空间</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">NotebookLM-style</div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button id="btn-reindex" title="重建向量索引">重建索引</button>
      <div class="status" id="status">就绪</div>
    </div>
  </header>
  <main class="layout">
    <aside class="sidebar">
      <section>
        <h2>来源 Sources</h2>
        <div class="source-form">
          <label>名称 <input id="src-name" placeholder="例如：产品文档" /></label>
          <label>类型
            <select id="src-type">
              <option value="text">文本</option>
              <option value="url">网页URL</option>
              <option value="pdf">PDF(占位)</option>
            </select>
          </label>
          <label id="content-wrap"><textarea id="src-content" rows="6" placeholder="在此粘贴文本内容"></textarea></label>
          <label id="url-wrap" style="display:none;"><input id="src-url" placeholder="https://..." /></label>
          <label>或上传文件（pdf/xlsx/csv/json/srt/vtt/txt/md）
            <input id="file-input" type="file" accept=".pdf,.xlsx,.csv,.json,.srt,.vtt,.txt,.md" />
          </label>
          <button id="btn-add-src">添加来源</button>
        </div>
        <div class="source-list" id="source-list"></div>
      </section>
    </aside>

    <section class="content">
      <section class="card">
        <h2>AI 深度问答 Ask AI</h2>
        <div class="ask">
          <textarea id="question" placeholder="输入你的问题...（将自动引用所选来源）" rows="3"></textarea>
          <div class="ask-actions">
            <button id="btn-ask">提问</button>
            <button id="btn-copy-answer">复制回答</button>
            <span>已选来源：<span id="selected-count">0</span></span>
          </div>
        </div>
        <div id="answer" class="answer"></div>
      </section>

      <section class="card">
        <h2>Flow 编排</h2>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <label>选择流程
            <select id="flow-id">
              <option value="summary_slides_quiz">摘要 → PPT → 测验</option>
            </select>
          </label>
          <label>幻灯片模板
            <select id="flow-slides-template">
              <option value="商务">商务</option>
              <option value="简洁">简洁</option>
              <option value="学术">学术</option>
              <option value="蓝色系">蓝色系</option>
              <option value="红色系">红色系</option>
            </select>
          </label>
          <label style="min-width:260px;flex:1;">步骤（逗号分隔）
            <input id="steps-input" placeholder="summary,slides,quiz" value="summary,slides,quiz" />
          </label>
          <button id="btn-run-flow">运行 Flow</button>
          <button id="btn-run-steps">运行自定义步骤</button>
          <button id="btn-copy-flow">复制全部</button>
          <button id="btn-dl-flow">下载为 Markdown</button>
          <button id="btn-dl-flow-json">下载 Flow JSON</button>
          <button id="btn-save-defaults" title="保存为默认设置">设为默认</button>
        </div>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:6px;">
          <input id="preset-name" placeholder="预设名称（保存为预设）" style="flex:1;min-width:200px;" />
          <button id="btn-save-preset">保存为预设</button>
          <label>预设
            <select id="preset-select"></select>
          </label>
          <button id="btn-del-preset" title="删除选中预设">删除预设</button>
          <button id="btn-update-preset" title="用当前设置更新预设">更新预设</button>
          <label><input type="checkbox" id="batch-per-source" /> 逐条来源批跑</label>
          <button id="btn-run-preset">运行预设</button>
          <button id="btn-dl-batch">下载批处理结果</button>
          <button id="btn-dl-batch-json">下载批处理 JSON</button>
          <button id="btn-load-jobs">查看最近任务</button>
        </div>
        <div id="flow-output" class="gen-output" style="margin-top:8px;"></div>
        <div id="batch-output" class="gen-output" style="margin-top:8px;"></div>
        <div id="jobs-output" class="gen-output" style="margin-top:8px;"></div>
      </section>

      <section class="card">
        <h2>生成器 Generators</h2>
        <div class="gen-actions">
          <button data-type="audio_overview">音频概览</button>
          <button data-type="video_overview">视频概览</button>
          <button data-type="mind_map">思维导图</button>
          <button data-type="report">结构化报告</button>
          <button data-type="flashcards">闪卡</button>
          <button data-type="quiz">测验</button>
          <button data-type="slides">PPT 大纲</button>
        </div>
        <div class="ask-actions" style="margin-top:6px">
          <button id="btn-copy-gen">复制生成内容</button>
          <button id="btn-dl-gen">下载为 Markdown</button>
        </div>
        <div id="gen-output" class="gen-output"></div>
      </section>
    </section>
  </main>

  <script src="/app.js"></script>
  <script>
    // toggle inputs by type
    const typeSel = document.getElementById('src-type');
    const urlWrap = document.getElementById('url-wrap');
    const contentWrap = document.getElementById('content-wrap');
    typeSel.addEventListener('change', () => {
      const v = typeSel.value;
      urlWrap.style.display = v === 'url' ? '' : 'none';
      contentWrap.style.display = v === 'url' ? 'none' : '';
    });
  </script>
</body>
<!-- 输出规范：
1) 结构清晰；2) 引用来源；3) 可复制；4) 提供可选版本；5) 可扩展。
-->
</html>
